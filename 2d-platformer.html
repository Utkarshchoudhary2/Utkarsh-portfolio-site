<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>2D Platformer Shooting Game</title>
<style>
  body {
    margin: 0; background: #10192b; color: white; overflow: hidden;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
    touch-action: none;
  }
  #game-container {
    width: 100vw; max-width: 600px; height: 90vh; outline: 3px solid #5bbefa;
    position: relative;
    user-select: none;
  }
  #touch-controls {
    position: absolute; bottom: 20px; left: 20px;
    display: flex; gap: 15px;
    z-index: 10;
  }
  #touch-controls button {
    width: 60px; height: 60px; font-size: 24px;
    background: #005f9e; border: none; border-radius: 12px; color: white;
    opacity: 0.8;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>

<div id="game-container"></div>

<!-- Touch Controls for Mobile -->
<div id="touch-controls">
  <button id="left-btn">◀</button>
  <button id="jump-btn">▲</button>
  <button id="right-btn">▶</button>
  <button id="shoot-btn">●</button>
</div>

<script>
class MainScene extends Phaser.Scene {
  constructor() {
    super("MainScene");
  }
  preload() {
    this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
    this.load.image('player', 'https://labs.phaser.io/assets/sprites/phaser-dude.png');
    this.load.image('bullet', 'https://labs.phaser.io/assets/sprites/bullets/bullet7.png');
    this.load.image('enemy', 'https://labs.phaser.io/assets/sprites/robot.png');
  }
  create() {
    this.platforms = this.physics.add.staticGroup();
    this.platforms.create(300, 580, 'ground').setScale(2).refreshBody();
    this.platforms.create(120, 440, 'ground');
    this.platforms.create(450, 350, 'ground');

    this.player = this.physics.add.sprite(100, 450, 'player').setScale(1.2);
    this.player.setBounce(0.2);
    this.player.setCollideWorldBounds(true);
    this.physics.add.collider(this.player, this.platforms);

    this.cursors = this.input.keyboard.createCursorKeys();
    this.spaceBar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

    this.bullets = this.physics.add.group({ defaultKey: 'bullet', maxSize: 10 });

    this.enemies = this.physics.add.group();
    this.spawnEnemy();

    this.physics.add.collider(this.enemies, this.platforms);
    this.physics.add.overlap(this.bullets, this.enemies, this.hitEnemy, null, this);

    this.shootCoolDown = 0;

    // Mobile control state
    this.leftPressed = false;
    this.rightPressed = false;
    this.jumpPressed = false;
    this.shootPressed = false;

    // Setup touch events for mobile buttons
    const leftBtn = document.getElementById('left-btn');
    const rightBtn = document.getElementById('right-btn');
    const jumpBtn = document.getElementById('jump-btn');
    const shootBtn = document.getElementById('shoot-btn');

    leftBtn.addEventListener('touchstart', () => { this.leftPressed = true; });
    leftBtn.addEventListener('touchend', () => { this.leftPressed = false; });

    rightBtn.addEventListener('touchstart', () => { this.rightPressed = true; });
    rightBtn.addEventListener('touchend', () => { this.rightPressed = false; });

    jumpBtn.addEventListener('touchstart', () => { this.jumpPressed = true; });
    jumpBtn.addEventListener('touchend', () => { this.jumpPressed = false; });

    shootBtn.addEventListener('touchstart', () => { this.shootPressed = true; });
    shootBtn.addEventListener('touchend', () => { this.shootPressed = false; });
  }
  spawnEnemy() {
    let enemy = this.enemies.create(500, 100, 'enemy').setScale(0.7);
    enemy.setBounce(1);
    enemy.setCollideWorldBounds(true);
    enemy.setVelocity(Phaser.Math.Between(-100, 100), 20);
  }
  hitEnemy(bullet, enemy) {
    bullet.disableBody(true, true);
    enemy.disableBody(true, true);
    this.time.delayedCall(2000, () => this.spawnEnemy(), [], this);
  }
  shootBullet() {
    let bullet = this.bullets.get(this.player.x, this.player.y);
    if (bullet) {
      bullet.setActive(true);
      bullet.setVisible(true);
      bullet.body.allowGravity = false;
      bullet.setVelocityX(this.player.flipX ? -400 : 400);
      bullet.y -= 8;
      bullet.x += this.player.flipX ? -15 : 15;
      this.shootCoolDown = this.time.now + 400;
    }
  }
  update(time) {
    // Keyboard controls
    if (this.cursors.left.isDown || this.leftPressed) {
      this.player.setVelocityX(-160);
      this.player.flipX = true;
    } else if (this.cursors.right.isDown || this.rightPressed) {
      this.player.setVelocityX(160);
      this.player.flipX = false;
    } else {
      this.player.setVelocityX(0);
    }
    if ((this.cursors.up.isDown || this.jumpPressed) && this.player.body.touching.down) {
      this.player.setVelocityY(-330);
    }
    if ((Phaser.Input.Keyboard.JustDown(this.spaceBar) || this.shootPressed) && time > this.shootCoolDown) {
      this.shootBullet();
    }

    this.bullets.children.each(function (bullet) {
      if (bullet.active && (bullet.x > 600 || bullet.x < 0)) {
        bullet.disableBody(true, true);
      }
    }, this);
  }
}

const config = {
  type: Phaser.AUTO,
  width: 600,
  height: 600,
  backgroundColor: "#10192b",
  physics: {
    default: "arcade",
    arcade: {
      gravity: { y: 500 },
      debug: false
    }
  },
  scene: MainScene,
  parent: "game-container",
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  }
};

const game = new Phaser.Game(config);
</script>

</body>
</html>