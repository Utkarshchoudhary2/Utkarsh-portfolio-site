<!-- flappy.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Play Flappy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./css/style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/guard.js"></script>
  <style>body{margin:0;background:#000}canvas{display:block;margin:0 auto;background:#70c5ce}</style>
</head>
<body>
  <canvas id="game" width="360" height="640"></canvas>
  <script>
    // simple mobile-friendly flappy
    const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
    let w=canvas.width, h=canvas.height;
    let bird={x:80,y:h/2,vy:0,gravity:0.8,flap:-12,size:24};
    let pipes=[], tick=0, gap=150, speed=2, score=0;
    function spawn(){ let top = 50 + Math.random()*(h-300); pipes.push({x:w,top:top}); }
    function update(){
      tick++; bird.vy += bird.gravity; bird.y+=bird.vy;
      if (tick%120===0) spawn();
      for(let i=pipes.length-1;i>=0;i--){
        pipes[i].x -= speed;
        if (pipes[i].x + 60 < -50) { pipes.splice(i,1); score++; }
        // collision
        if (bird.x + bird.size > pipes[i].x && bird.x < pipes[i].x + 60) {
          if (bird.y < pipes[i].top || bird.y + bird.size > pipes[i].top + gap) {
            reset();
          }
        }
      }
      if (bird.y + bird.size > h) reset();
    }
    function draw(){
      ctx.fillStyle='#70c5ce'; ctx.fillRect(0,0,w,h);
      ctx.fillStyle='yellow'; ctx.fillRect(bird.x,bird.y,bird.size,bird.size);
      ctx.fillStyle='green';
      pipes.forEach(p=>{
        ctx.fillRect(p.x,0,60,p.top);
        ctx.fillRect(p.x,p.top+gap,60,h);
      });
      ctx.fillStyle='black'; ctx.font='20px Arial'; ctx.fillText('Score: '+score,10,30);
    }
    function loop(){ update(); draw(); requestAnimationFrame(loop); }
    function flap(){ bird.vy = bird.flap; }
    function reset(){ bird.y=h/2; bird.vy=0; pipes=[]; score=0; tick=0; }
    // controls
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); flap(); }, {passive:false});
    canvas.addEventListener('mousedown', flap);
    loop();
  </script>
</body>
</html>